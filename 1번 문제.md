## 동시에 같은 DB Table row 를 업데이트
---
동시에 같은 DB Table row를 업데이트를 실행하면 교착상태(Deadlock)가 발생한다. 즉 둘 이상의 프로세스가 서로 작업이 끝나길 기다린다는 것이다.

교착상태의 원인은 상호배제, 점유 와 대기, 비선점, 환형 대기가 있다.

상호배제(Mutual Exclusion): 한번에 한개의 프로세스만이 공유 자원을 사용할 수 있다.

점유와 대기 (Hold and Waite): 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용되고 있는 자원을 추가로 점유하기 이해 대기하는 프로세스가 있어야 한다.

비선점(Non-preemption): 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없어야 한다.

환형 대기(Circular Wait): 공유자원과 공유자원을 사용하기 위해 대기하는 프로세슷들이 원형으로 구성되어 있어 자신에게 할당된 자원을 점유하면서 앞이나 뒤에 있는 프로세스의 자원을 요구한다.

---

그러면 본론으로 돌아와서 어떻게 해결하는 방법이 좋을까?

레코드락(row lock)을 사용해서 row에 접근시 다른 프로세스가 접근을 막을 수 있을 것 같다.

또는 Kafka 같은 message queue를 도입해 request를 queue로 정렬해 처리할 수도 있을 거 같다.

